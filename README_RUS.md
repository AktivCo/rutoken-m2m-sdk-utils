[Английский/English](README_EN.md)

# Rutoken M2M SDK Utils

Этот проект -- набор утилит для использования в [Рутокен M2M SDK](https://www.rutoken.ru/products/all/rutoken-m2m/).

## rt-control

**rt-control** -- утилита управления физическим подключением смарт-карт на [демонстрационной плате Рутокен M2M](https://www.rutoken.ru/products/all/rutoken-m2m/) и статусом выполнения системного ПО, обеспечивающего доступ к смарт-картам.

### Синтаксис

`rt-control <команда> [аргументы команды]`

### Описание

Утилита **rt-control** используется для управления физическим подключением смарт-карт подключенных к [демонстрационной плате Рутокен M2M -- Рутокен 4990](https://www.rutoken.ru/products/all/rutoken-m2m/) и запуском/остановкой системного ПО, обеспечивающего доступ к смарт-картам. Утилита позволяет управлять питанием смарт-карт на демонстрационной плате Рутокен M2M; запускать, останавливать, изменять уровень логирования pcscd; отбражать текущее состояние подключения устройств и запуска ПО.

### Команды

##### `-s, --select_devices <device> [<device>...]`

Включает питание указанных смарт-карт и обеспечивает доступ к ним через PC/SC-интерфейс. Смарт-карты, не указанные в списке аргументов команды, будут отключены.
В качестве параметра `device` можно указать:
    * `2010` -- Рутокен 2010
    * `4010` -- Рутокен 4010
    * `21xx` -- считыватель MicroSIM

Следует отметить, что одновременное использование Рутокен 4010 и считывателя MicroSIM не поддерживается в связи с особенностями разводки на демонстрационной плате Рутокен M2M.

##### `-l, --log_level [-c <ccid_log_level>] [-u <rtuart_log_level>]`

Включает логирование pcscd. Pcscd запускается с опциями `-a -d`. Дополнительное указание опций `-c <ccid_log_level>` и `-u <rtuart_log_level>` позволяет настроить уровень логирования драйверов [CCID](https://ccid.apdu.fr/) и [rtuart](https://github.com/AktivCo/rtuart). Их уровень логирования задается числом от 0 до 15. Описание значений доступно в документации драйверов.

##### `-d, --disable_log`

Отключает логирование pcscd. Pcscd перезапускается без дополнительных опций. Логирование драйверов, загруженных pcscd, также отключается.

##### `-p, --pcscd  <start|stop|restart>`

Запускает, останавливает и перезапускает pcscd. Если pcscd остановлен, приложения не могут обращаться к интерфейсу PC/SC. Запуск pcscd происходит с опциями, получившимися в результате выполнения команд `-l` and `-d`.

##### `-i, --info`

Отображает информацию о статусе питания смарт-карт, доступа к ним через PC/SC-интерфейс, о статусе запуска и уровне логирования pcscd.

##### `-h, --help`

Отображает справочное сообщение.

## rt-run-sample

**rt-run-sample** - утилита для запуска приложения в модифицированном окружении: с включенным pcsc-spy и с выбранным набором подключенных к демонстрационной плате Рутокен M2M.

### Синтаксис

`rt-run-sample [<option>...] -p <path>`

### Описание

**rt-run-sample** позволяет запустить приложение в модифицированном окружении. Утилита позволяет включить логирование обращений к PC/SC-интерфейсу при помощи pcsc-spy. Если включено логирование, логи пишутся по пути `~/log/`. Кроме того, утилита позволяет отключить питние части смарт-карт на демонстрационной плате Рутокен M2M, так чтобы приложения, не ожидающие, что подключены несколько смарт-карт, работали корректно.

### Опции

##### `-s`

Включает логирование обращений к PC/SC-интерфейсу при помощи pcsc-spy. Логи пишутся по пути `~/log/`.

##### `-l`

Перенаправляет вывод приложения в файл внутри директории `~/log`.

##### `-d <device>`

Указывает, какие смарт-карты будут подключены во время выполнения приложения.

Поддерживаемые значения:
    * 2010 -- только Рутокен 2010.
    * 4010 -- только с.
    * all -- и Рутокен 2010, и Рутокен 2010.

##### `-p <path>`

Указывает путь до исполняемого приложения.

##### `-h`

Отображает справочное сообщение.

### Замечания

Главная причина использовать данную утилиту в Рутокен M2M SDK: примеры Рутокен SDK, распространяемые в составе Рутокен M2M SDK используют первый найденный через PKCS#11 слот со смарт-картой, так что неизвестно, с какой из включенных смарт-карт было произведено взаимодействие.

## rt-uart-test

**rt-uart-test** - утилита, предназначенная для запуска приложения rtuart_transport_test в предустановленном окружении.

### Синтаксис

`rt-uart-test [option]`

### Описание

Приложение **rtuart_transport_test** распространяется в составе проекта [rtuart](https://github.com/AktivCo/rtuart). Это тест низкоуровнего протокола взаимодействия с Рутокен 4010. Для корректного выполнения приложения требуется, чтобы Рутокен 4010 был подключен, а драйвер rtuart -- остановлен. Утилита **rt-uart-test**, в зависимости от режима работы, либо проверяет, что данные условия выполнены, и только в этом случае запускает тест, либо сама обеспечивает выполнение указанных условий (подает питание на Рутокен 4010 и останавливает pcscd) и запускает тест.

### Опции

##### `-f, --force`

Настраивает окружение для корректного выполнения rtuart_transport_test: станавливает pcscd, подает питание на Рутокен 4010. Если опция не указана, происходит проверка условий выполнения и исполнение теста, если проверка прошла успешно.

##### `-h`

Отображает справочное сообщение.
